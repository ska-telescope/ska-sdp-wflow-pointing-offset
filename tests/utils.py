# pylint: disable=too-many-return-statements, inconsistent-return-statements
# pylint: disable=too-few-public-methods
"""
Common Variables and Mock Class Objects used for testing
"""
import numpy
import pandas
from astropy.coordinates import EarthLocation, SkyCoord
from astropy.units import Quantity
from ska_sdp_datamodels.science_data_model.polarisation_model import (
    PolarisationFrame,
)
from ska_sdp_datamodels.visibility.vis_utils import generate_baselines

from ska_sdp_wflow_pointing_offset import construct_antennas

NTIMES = 5
NANTS = 3
NCHAN = 5
NCORR = 15
NPOL = 2
BEAMWIDTH_FACTOR = (0.96, 1.098)
THRESH_WIDTH = 1.5
XYZ = numpy.array(
    [
        [5109237.714735, 2006795.661955, -3239109.183708],
        [5109251.156928, 2006811.008353, -3239078.678007],
        [5109238.357021, 2006770.325838, -3239123.769211],
    ]
)
LOCATION = EarthLocation(
    x=Quantity(XYZ[0][0], "m"),
    y=Quantity(XYZ[0][1], "m"),
    z=Quantity(XYZ[0][2], "m"),
)
DIAMETER = numpy.array([25.0, 25.0, 25.0])
STATION = [
    "SKAMID-CORE",
    "SKAMID-CORE",
    "SKAMID-CORE",
]
NAME = ["SKA001", "SKA002", "SKA003"]
MOUNT = ["ALT-AZ", "ALT-AZ", "ALT-AZ"]
OFFSET = numpy.array(
    [
        [0.00000000e00, 0.00000000e00, 0.00000000e00],
        [2.18848512e-03, 0.00000000e00, 0.00000000e00],
        [-3.02790361e-03, 0.00000000e00, 0.00000000e00],
    ]
)
ANTS = construct_antennas(XYZ, DIAMETER, STATION)
BASELINES = pandas.MultiIndex.from_tuples(
    generate_baselines(NANTS), names=("antenna1", "antenna2")
)
UVW = numpy.array(
    [
        [
            [0.0, 0.0, 0.0],
            [-397.89452612, 584.1169983, -153.35096251],
            [-1357.78172302, 56.39427491, -30.15833161],
            [-33.08582193, -422.93637971, 107.28705751],
            [0.0, 0.0, 0.0],
            [-959.8871969, -527.7227234, 123.1926309],
        ],
        [
            [0.0, 0.0, 0.0],
            [-397.67291131, 584.32154768, -153.14641314],
            [-1357.76787287, 57.09247337, -29.46013315],
            [-33.24812717, -422.9193245, 107.30411272],
            [0.0, 0.0, 0.0],
            [-960.09496157, -527.2290743, 123.68627999],
        ],
        [
            [0.0, 0.0, 0.0],
            [-397.45108619, 584.52598303, -152.94197778],
            [-1357.75330468, 57.79066453, -28.76194199],
            [-33.41041483, -422.90218584, 107.32125138],
            [0.0, 0.0, 0.0],
            [-960.30221849, -526.7353185, 124.18003579],
        ],
        [
            [0.0, 0.0, 0.0],
            [-397.22905088, 584.73030427, -152.73765654],
            [-1357.73801843, 58.48884802, -28.0637585],
            [-33.57268481, -422.88496373, 107.33847349],
            [0.0, 0.0, 0.0],
            [-960.50896755, -526.24145625, 124.67389804],
        ],
        [
            [0.0, 0.0, 0.0],
            [-397.0068055, 584.93451128, -152.53344954],
            [-1357.72201414, 59.18702345, -27.36558307],
            [-33.73493705, -422.86765818, 107.35577904],
            [0.0, 0.0, 0.0],
            [-960.71520865, -525.74748782, 125.16786647],
        ],
    ]
)


# Define the parameters for fit primary beam function
CORR_TYPE = ["XX", "YY"]
POLARISATION_FRAME = PolarisationFrame("linearnp")
VIS_TIMESTAMPS = numpy.array(
    [5.17944476e09, 5.17944477e09, 5.17944480e09, 5.17944480e09, 5.17944483e09]
)
POINTING_TIMESTAMPS = numpy.array(
    [
        1.67272797e09,
        1.67272798e09,
        1.67272800e09,
        1.67272801e09,
        1.67272803e09,
    ]
)
INTEGRATION_TIME = numpy.array(
    [7.99661697, 7.99661697, 7.99661697, 7.99661697, 7.99661697]
)
INTERVAL = numpy.array(
    [7.99661732, 7.99661732, 23.98985195, 7.99661636, 23.98985195]
)
FREQS = numpy.array(
    [
        8.56000000e08,
        8.56208984e08,
        8.56417969e08,
        8.56626953e08,
        8.56835938e08,
    ]
)
CHANNEL_BANDWIDTH = numpy.array(
    [208984.375, 208984.375, 208984.375, 208984.375, 208984.375]
)
SOURCE = "J1939-6342"
PHASECENTRE = SkyCoord(294.85429167, -63.71266667, unit="deg")

# y-parameter when fitting the primary beam to the visibilities
VIS = numpy.array(
    [
        [
            [
                [
                    6.24694092e03 + 0.00000000e00j,
                    -3.01851583e00 + 9.65647125e00j,
                ],
                [
                    6.00303467e03 + 0.00000000e00j,
                    3.69860029e00 + 1.36743994e01j,
                ],
                [
                    6.65865430e03 + 0.00000000e00j,
                    5.94074726e-01 + 1.31747465e01j,
                ],
                [
                    6.57971143e03 + 0.00000000e00j,
                    1.92299461e00 + 1.27297878e01j,
                ],
                [
                    6.33100830e03 + 0.00000000e00j,
                    -5.45699024e00 + 1.66821709e01j,
                ],
            ],
            [
                [
                    -1.47477350e01 + 2.70263424e01j,
                    -6.42751217e-01 - 1.84103031e01j,
                ],
                [
                    -1.45032978e00 + 2.85750465e01j,
                    -3.20934939e00 - 5.90691280e00j,
                ],
                [
                    -5.08417130e00 + 2.98439026e01j,
                    -1.50017786e00 - 4.69353342e00j,
                ],
                [
                    7.78958988e00 + 2.68464985e01j,
                    -6.20502234e-01 - 8.77887344e00j,
                ],
                [
                    8.70306015e-01 + 3.64439430e01j,
                    -5.37184334e00 - 1.25341797e01j,
                ],
            ],
            [
                [
                    1.73821316e01 - 3.14625034e01j,
                    1.07556963e00 + 6.79846478e00j,
                ],
                [
                    9.76719570e00 - 3.37108192e01j,
                    -2.17240930e00 + 1.13093109e01j,
                ],
                [
                    1.84735641e01 - 4.03612137e01j,
                    -5.42944050e00 + 8.68369579e00j,
                ],
                [
                    2.05905590e01 - 4.36481590e01j,
                    -2.96061707e00 + 1.54786558e01j,
                ],
                [
                    1.07541075e01 - 4.11157799e01j,
                    -8.21459103e00 + 7.13716555e00j,
                ],
            ],
            [
                [
                    3.67958107e01 - 6.50892258e00j,
                    -9.99655151e00 + 7.82431316e00j,
                ],
                [
                    3.75205574e01 - 6.52736187e-01j,
                    -1.26847210e01 + 7.98128986e00j,
                ],
                [
                    3.62506027e01 + 4.05663300e00j,
                    -9.92957592e00 + 3.76166344e00j,
                ],
                [
                    4.04956398e01 + 3.48440456e00j,
                    -9.37492275e00 + 6.75404072e00j,
                ],
                [
                    3.28653221e01 + 6.91183233e00j,
                    -6.85607338e00 - 2.17796278e00j,
                ],
            ],
            [
                [
                    9.42231750e00 + 1.94350433e00j,
                    -6.45631790e-01 - 1.27879930e00j,
                ],
                [
                    8.51097202e00 - 3.77745485e00j,
                    5.41565418e-02 - 2.85956740e00j,
                ],
                [
                    1.15152397e01 - 2.95445609e00j,
                    -5.22002697e00 - 2.67412066e00j,
                ],
                [
                    1.16987143e01 - 6.15562677e00j,
                    -2.54762959e00 - 2.52539206e00j,
                ],
                [
                    1.63195839e01 - 4.63360119e00j,
                    -1.84541345e00 - 1.08183222e01j,
                ],
            ],
            [
                [
                    1.16914759e01 + 8.45952129e00j,
                    5.49171972e00 - 6.37186348e-01j,
                ],
                [
                    7.77442265e00 + 1.07652817e01j,
                    -6.65402317e00 - 5.64390755e00j,
                ],
                [
                    6.85944176e00 + 1.14482279e01j,
                    -3.28827357e00 + 1.74217093e00j,
                ],
                [
                    1.87185299e00 + 5.69923162e00j,
                    -2.07027388e00 - 3.40364790e00j,
                ],
                [
                    1.01731491e01 - 4.37499046e-01j,
                    1.60982275e00 - 1.46397102e00j,
                ],
            ],
        ],
        [
            [
                [
                    2.42840137e03 + 0.00000000e00j,
                    -2.87907529e00 + 5.64665222e00j,
                ],
                [
                    2.33047656e03 + 0.00000000e00j,
                    -1.09805405e00 + 1.75753498e00j,
                ],
                [
                    2.59160400e03 + 0.00000000e00j,
                    1.91530108e00 + 2.49657607e00j,
                ],
                [
                    2.55148999e03 + 0.00000000e00j,
                    2.60396671e00 + 5.32829142e00j,
                ],
                [
                    2.45881348e03 + 0.00000000e00j,
                    1.25261176e00 + 5.16645288e00j,
                ],
            ],
            [
                [
                    -4.13912535e00 + 9.29463482e00j,
                    2.03599930e-01 - 5.99453640e00j,
                ],
                [
                    -1.26888204e00 + 7.86334991e00j,
                    6.81141615e-02 - 4.40146160e00j,
                ],
                [
                    -2.26336050e00 + 1.18967276e01j,
                    -1.55320549e00 - 1.71579564e00j,
                ],
                [
                    8.29293728e-01 + 1.15149469e01j,
                    -2.63544321e-02 - 1.54678106e00j,
                ],
                [
                    1.69359779e00 + 1.26314888e01j,
                    -1.42418420e00 - 8.45983148e-01j,
                ],
            ],
            [
                [
                    -1.10437679e00 - 1.41055183e01j,
                    8.27971458e-01 + 3.43274689e00j,
                ],
                [
                    -1.73416662e00 - 1.52722855e01j,
                    3.85458565e00 + 4.32193804e00j,
                ],
                [
                    -1.23099852e00 - 1.28073626e01j,
                    -7.76298046e-01 + 6.98482847e00j,
                ],
                [
                    -9.39108133e-01 - 1.14512587e01j,
                    -8.35404992e-01 + 4.59742928e00j,
                ],
                [
                    1.63491631e00 - 1.23164062e01j,
                    6.28131986e-01 + 5.13064766e00j,
                ],
            ],
            [
                [
                    1.09577503e01 - 7.73429155e00j,
                    -2.85304117e00 + 1.16004801e00j,
                ],
                [
                    1.12833805e01 - 6.85215807e00j,
                    -2.47456670e-01 + 2.80945635e00j,
                ],
                [
                    1.32826729e01 - 4.48984194e00j,
                    -2.24926019e00 + 2.78979588e00j,
                ],
                [
                    1.32549067e01 - 5.37247181e00j,
                    -3.47398257e00 + 1.54893756e-01j,
                ],
                [
                    1.19814844e01 - 3.46984339e00j,
                    -4.82467794e00 - 1.80974960e-01j,
                ],
            ],
            [
                [
                    4.90352821e00 + 2.17881775e00j,
                    3.34668159e-03 + 4.82523775e00j,
                ],
                [
                    6.92879820e00 + 3.97381067e-01j,
                    -1.05196953e00 + 4.31111276e-01j,
                ],
                [
                    3.14184546e00 - 1.97286606e00j,
                    -1.00418603e00 - 2.88441586e00j,
                ],
                [
                    4.91966438e00 + 1.54034400e00j,
                    -3.38303280e00 + 5.24806738e-01j,
                ],
                [
                    5.76249981e00 - 1.86200500e00j,
                    1.49025992e-02 - 2.35341683e-01j,
                ],
            ],
            [
                [
                    7.71259022e00 + 6.68983832e-02j,
                    -7.51879662e-02 + 1.64642513e00j,
                ],
                [
                    4.82191992e00 + 7.54429579e-01j,
                    7.69332945e-01 - 1.79987729e00j,
                ],
                [
                    3.82484150e00 + 1.10087276e00j,
                    -1.70933795e00 - 2.84355015e-01j,
                ],
                [
                    3.50662065e00 + 1.86031127e00j,
                    8.42687249e-01 + 3.88354570e-01j,
                ],
                [
                    2.27104449e00 - 1.58158112e00j,
                    3.10192633e00 + 1.24001050e00j,
                ],
            ],
        ],
        [
            [
                [
                    5.47812378e02 + 0.00000000e00j,
                    3.02555943e00 + 2.62377357e00j,
                ],
                [
                    5.55288879e02 + 0.00000000e00j,
                    3.11850309e00 + 2.89744592e00j,
                ],
                [
                    5.50209351e02 + 0.00000000e00j,
                    3.08128691e00 + 3.33774257e00j,
                ],
                [
                    5.49259705e02 + 0.00000000e00j,
                    3.20582438e00 + 3.02165270e00j,
                ],
                [
                    5.46223633e02 + 0.00000000e00j,
                    3.19186378e00 + 2.26395988e00j,
                ],
            ],
            [
                [
                    1.31326895e01 + 3.78016543e00j,
                    -8.44620526e-01 - 5.00043556e-02j,
                ],
                [
                    1.37977657e01 + 3.62259674e00j,
                    -1.05719864e00 + 3.67913663e-01j,
                ],
                [
                    1.41755610e01 + 4.43005037e00j,
                    -1.46410716e00 - 1.29523873e-02j,
                ],
                [
                    1.48911963e01 + 5.05353355e00j,
                    -1.41654491e00 + 3.55841368e-01j,
                ],
                [
                    1.61245556e01 + 5.01223707e00j,
                    -1.04879665e00 + 4.30964381e-02j,
                ],
            ],
            [
                [
                    1.18910427e01 - 4.02105761e00j,
                    -9.89296257e-01 - 6.29471064e-01j,
                ],
                [
                    1.21846857e01 - 4.39076519e00j,
                    -8.12323689e-01 - 8.44593227e-01j,
                ],
                [
                    1.15641088e01 - 4.00334501e00j,
                    -9.58713293e-01 - 7.14589417e-01j,
                ],
                [
                    1.20020657e01 - 4.66652584e00j,
                    -5.17500699e-01 - 8.33721280e-01j,
                ],
                [
                    1.22685337e01 - 4.35479355e00j,
                    -1.51029527e-01 - 1.08626795e00j,
                ],
            ],
            [
                [
                    1.51394424e01 - 1.09157383e00j,
                    -5.84822476e-01 + 6.73798323e-02j,
                ],
                [
                    1.47219505e01 - 1.24514627e00j,
                    5.11431769e-02 + 4.28364389e-02j,
                ],
                [
                    1.50880175e01 - 6.74845457e-01j,
                    -8.61239493e-01 + 6.91177487e-01j,
                ],
                [
                    1.51972761e01 - 1.00868046e00j,
                    -8.44409466e-01 - 5.80920577e-02j,
                ],
                [
                    1.49124584e01 - 6.21342659e-03j,
                    -5.30426741e-01 - 2.93438613e-01j,
                ],
            ],
            [
                [
                    1.52170115e01 - 5.11386871e-01j,
                    -5.10373890e-01 - 7.85911381e-02j,
                ],
                [
                    1.52234974e01 + 1.40932798e-01j,
                    -9.25335288e-01 - 4.02571738e-01j,
                ],
                [
                    1.51521559e01 - 1.35045278e00j,
                    -2.61694431e-01 + 5.62207699e-02j,
                ],
                [
                    1.50704002e01 - 5.20735979e-02j,
                    -3.81798357e-01 - 4.87594783e-01j,
                ],
                [
                    1.50942297e01 - 3.59466076e-02j,
                    -7.08359182e-01 - 3.18416893e-01j,
                ],
            ],
            [
                [
                    1.57120399e01 + 1.56324863e-01j,
                    -6.39995396e-01 + 7.56148100e-02j,
                ],
                [
                    1.57665911e01 + 8.58131409e-01j,
                    -3.29214483e-01 - 2.91047618e-02j,
                ],
                [
                    1.49462147e01 + 1.00562191e00j,
                    -5.15103161e-01 - 2.38692984e-02j,
                ],
                [
                    1.50154457e01 + 1.16716480e00j,
                    -5.27018979e-02 + 1.88738137e-01j,
                ],
                [
                    1.44949703e01 + 1.45600843e00j,
                    -2.30828941e-01 - 3.11797649e-01j,
                ],
            ],
        ],
        [
            [
                [
                    5.49426819e02 + 0.00000000e00j,
                    2.63377476e00 + 3.35973930e00j,
                ],
                [
                    5.56770508e02 + 0.00000000e00j,
                    2.56876945e00 + 3.36830139e00j,
                ],
                [
                    5.51236389e02 + 0.00000000e00j,
                    2.57549334e00 + 3.30706096e00j,
                ],
                [
                    5.50421021e02 + 0.00000000e00j,
                    3.35639381e00 + 3.15430832e00j,
                ],
                [
                    5.47178833e02 + 0.00000000e00j,
                    2.93581271e00 + 3.11728668e00j,
                ],
            ],
            [
                [
                    1.13727217e01 + 5.73938656e00j,
                    -6.61861658e-01 - 3.74249548e-01j,
                ],
                [
                    1.24938097e01 + 6.46405506e00j,
                    -1.19937193e00 - 2.25286677e-01j,
                ],
                [
                    1.31510124e01 + 6.72023773e00j,
                    -1.06256175e00 + 3.68736118e-01j,
                ],
                [
                    1.42355919e01 + 7.36168337e00j,
                    -1.45714688e00 - 4.89163190e-01j,
                ],
                [
                    1.50376110e01 + 7.14649153e00j,
                    -1.22458732e00 + 2.93353707e-01j,
                ],
            ],
            [
                [
                    1.14769793e01 - 2.67466354e00j,
                    -3.51221472e-01 - 7.65687048e-01j,
                ],
                [
                    1.20099468e01 - 2.46263170e00j,
                    -6.29183710e-01 - 1.67350698e00j,
                ],
                [
                    1.22393017e01 - 3.21452999e00j,
                    -5.20989299e-01 - 5.63322723e-01j,
                ],
                [
                    1.24985247e01 - 2.90373015e00j,
                    -1.03363919e00 - 9.47783947e-01j,
                ],
                [
                    1.29455013e01 - 3.21128035e00j,
                    -2.84541368e-01 - 1.20845854e00j,
                ],
            ],
            [
                [
                    1.46948280e01 + 1.78574145e-01j,
                    -3.71151626e-01 - 3.86145890e-01j,
                ],
                [
                    1.48595028e01 + 5.97986758e-01j,
                    -1.07355702e00 - 3.65494519e-01j,
                ],
                [
                    1.45807657e01 + 2.56978512e-01j,
                    -7.52394259e-01 + 3.29933822e-01j,
                ],
                [
                    1.47086592e01 + 8.03486764e-01j,
                    -5.51293790e-01 + 5.30163884e-01j,
                ],
                [
                    1.45811176e01 + 8.49977732e-01j,
                    -4.71251786e-01 + 5.93910813e-01j,
                ],
            ],
            [
                [
                    1.54896145e01 + 1.00878978e00j,
                    -5.61293542e-01 + 4.36167330e-01j,
                ],
                [
                    1.51931019e01 + 1.28599072e00j,
                    8.27264786e-02 + 7.38766640e-02j,
                ],
                [
                    1.48480911e01 + 1.39771783e00j,
                    9.46620479e-02 - 2.00651795e-01j,
                ],
                [
                    1.52777891e01 + 1.74427676e00j,
                    -7.40885496e-01 - 1.93951368e-01j,
                ],
                [
                    1.48490753e01 + 1.12675571e00j,
                    1.86273456e-03 - 2.22565144e-01j,
                ],
            ],
            [
                [
                    1.60283604e01 + 1.79595757e00j,
                    -2.76655883e-01 + 1.55046925e-01j,
                ],
                [
                    1.56682730e01 + 1.51768923e00j,
                    -4.24946666e-01 - 5.02922416e-01j,
                ],
                [
                    1.56563873e01 + 1.90925694e00j,
                    -1.61686331e-01 + 2.99107105e-01j,
                ],
                [
                    1.50193081e01 + 2.58534622e00j,
                    -8.36582780e-02 + 3.73802185e-01j,
                ],
                [
                    1.46462135e01 + 1.82921362e00j,
                    -6.77786112e-01 + 2.20532641e-01j,
                ],
            ],
        ],
        [
            [
                [
                    5.57327148e02 + 0.00000000e00j,
                    4.63585186e00 - 5.58800340e-01j,
                ],
                [
                    5.55226746e02 + 0.00000000e00j,
                    4.48564005e00 - 1.73193932e-01j,
                ],
                [
                    5.54213318e02 + 0.00000000e00j,
                    4.79834175e00 + 3.97444487e-01j,
                ],
                [
                    5.53348694e02 + 0.00000000e00j,
                    4.40309477e00 - 6.28702879e-01j,
                ],
                [
                    5.49242249e02 + 0.00000000e00j,
                    4.55634737e00 - 6.02114677e-01j,
                ],
            ],
            [
                [
                    1.31612921e01 + 4.08844566e00j,
                    -1.01945245e00 - 8.78948420e-02j,
                ],
                [
                    1.35157070e01 + 4.76318741e00j,
                    -8.73789489e-01 - 4.35148120e-01j,
                ],
                [
                    1.42994871e01 + 4.87702847e00j,
                    -1.99047971e00 - 4.84286517e-01j,
                ],
                [
                    1.45365620e01 + 5.05217505e00j,
                    -1.46560431e00 - 3.16941023e-01j,
                ],
                [
                    1.46292648e01 + 5.39986324e00j,
                    -1.78733194e00 - 5.00437260e-01j,
                ],
            ],
            [
                [
                    1.05098772e01 - 3.13601780e00j,
                    2.26284549e-01 - 8.71234000e-01j,
                ],
                [
                    1.08259468e01 - 3.57472420e00j,
                    7.64917433e-01 - 8.17470610e-01j,
                ],
                [
                    1.16968632e01 - 4.20346832e00j,
                    7.40949959e-02 - 3.79772782e-01j,
                ],
                [
                    1.24418049e01 - 4.40126991e00j,
                    8.77269685e-01 - 9.81650829e-01j,
                ],
                [
                    1.29528456e01 - 4.39644337e00j,
                    9.77726936e-01 - 7.24356949e-01j,
                ],
            ],
            [
                [
                    1.36826811e01 - 1.27758980e-01j,
                    -5.48859537e-02 - 7.90490270e-01j,
                ],
                [
                    1.39847956e01 - 5.31791568e-01j,
                    -8.88434350e-01 - 1.71710193e-01j,
                ],
                [
                    1.32853022e01 - 1.38598835e00j,
                    -7.44576693e-01 - 2.88958848e-01j,
                ],
                [
                    1.35037222e01 - 1.84013796e00j,
                    -3.27003747e-01 - 6.04038119e-01j,
                ],
                [
                    1.46160898e01 - 1.47817826e00j,
                    -1.67556152e-01 - 3.00818175e-01j,
                ],
            ],
            [
                [
                    1.55230322e01 - 5.30882478e-01j,
                    1.16460890e-01 + 3.98178250e-02j,
                ],
                [
                    1.62991180e01 - 2.00702906e-01j,
                    -1.23638779e-01 + 1.10870771e-01j,
                ],
                [
                    1.60663452e01 + 4.85749722e-01j,
                    -2.33571053e-01 + 4.47173566e-01j,
                ],
                [
                    1.61244736e01 + 2.32624888e-01j,
                    -4.69290018e-02 + 4.21410352e-01j,
                ],
                [
                    1.53596029e01 + 2.22538948e-01j,
                    -2.11027905e-01 - 2.04819143e-01j,
                ],
            ],
            [
                [
                    1.60851917e01 + 8.14929008e-02j,
                    -1.89295396e-01 - 3.43189299e-01j,
                ],
                [
                    1.64060230e01 + 7.80892849e-01j,
                    -4.18707609e-01 - 4.90996391e-02j,
                ],
                [
                    1.64974632e01 - 4.03847694e-02j,
                    -1.40523434e-01 + 4.96555924e-01j,
                ],
                [
                    1.57790260e01 + 1.01567411e00j,
                    -1.50609165e-02 - 4.18654025e-01j,
                ],
                [
                    1.55289860e01 + 1.47967958e00j,
                    -2.26100415e-01 - 3.63782421e-02j,
                ],
            ],
        ],
    ]
)


# y-parameter when fitting the primary beam to the gain amplitudes
GAIN = numpy.array(
    [
        [
            [
                [
                    [1.98762708 + 0.00468363j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.98722167 + 0.01273955j],
                ]
            ],
            [
                [
                    [1.9805374 - 0.00259519j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.96818067 + 0.00610415j],
                ]
            ],
            [
                [
                    [1.99001485 + 0.02336892j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.94290814 + 0.02793795j],
                ]
            ],
        ],
        [
            [
                [
                    [2.00749956 + 0.46457728j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.96016786 + 0.43255224j],
                ]
            ],
            [
                [
                    [1.98391337 + 0.41575343j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.92633737 + 0.4720727j],
                ]
            ],
            [
                [
                    [1.99703873 - 0.54565571j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.93822325 - 0.44815771j],
                ]
            ],
        ],
        [
            [
                [
                    [2.0014137 - 0.07993824j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 2.00094249 - 0.03064635j],
                ]
            ],
            [
                [
                    [1.99891215 + 0.08190329j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.9988133 + 0.01560186j],
                ]
            ],
            [
                [
                    [1.99945753 + 0.03106503j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.99788286 - 0.0058616j],
                ]
            ],
        ],
        [
            [
                [
                    [2.00060917 - 0.16212387j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.99910105 - 0.06334603j],
                ]
            ],
            [
                [
                    [1.99874346 + 0.15957328j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.99774502 + 0.02463885j],
                ]
            ],
            [
                [
                    [2.00031171 + 0.06336577j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.99646371 - 0.01033008j],
                ]
            ],
        ],
        [
            [
                [
                    [1.90125428 + 0.45048568j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.85299348 - 0.52040699j],
                ]
            ],
            [
                [
                    [1.93956563 + 0.40819864j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 2.02733306 + 0.19520254j],
                ]
            ],
            [
                [
                    [1.97188759 + 0.32419697j, 0.0 + 0.0j],
                    [0.0 + 0.0j, 1.96823741 + 0.32789823j],
                ]
            ],
        ],
    ]
)

GAIN_WEIGHT = numpy.array(
    [
        [
            [[[751.35095037, 0.0], [0.0, 730.97438541]]],
            [[[765.57530185, 0.0], [0.0, 739.96660188]]],
            [[[737.14404368, 0.0], [0.0, 741.61800441]]],
        ],
        [
            [[[247.60881609, 0.0], [0.0, 249.77351994]]],
            [[[248.39477351, 0.0], [0.0, 246.25917495]]],
            [[[234.7392233, 0.0], [0.0, 243.52235635]]],
        ],
        [
            [[[726.81274494, 0.0], [0.0, 642.53790686]]],
            [[[728.60464467, 0.0], [0.0, 632.35684225]]],
            [[[707.82600997, 0.0], [0.0, 637.63494049]]],
        ],
        [
            [[[725.94251634, 0.0], [0.0, 643.78875462]]],
            [[[727.58531841, 0.0], [0.0, 633.9413259]]],
            [[[707.83828707, 0.0], [0.0, 639.10712954]]],
        ],
        [
            [[[808.89395889, 0.0], [0.0, 702.1304842]]],
            [[[801.54047147, 0.0], [0.0, 686.4077971]]],
            [[[786.41670528, 0.0], [0.0, 699.14209769]]],
        ],
    ]
)


GAIN_RESIDUAL = numpy.array(
    [
        [[[2.18231239, 0.0], [0.0, 2.37574335]]],
        [[[0.82453787, 0.0], [0.0, 0.866436]]],
        [[[0.18392438, 0.0], [0.0, 0.17862158]]],
        [[[0.19306114, 0.0], [0.0, 0.18525042]]],
        [[[0.80434434, 0.0], [0.0, 0.7954749]]],
    ]
)


# y-parameter when fitting the primary beam to the visibilities
# Weights - used as standard deviation on the y-parameter when
# fitting the primary beams to visibility amplitudes
VIS_WEIGHTS = numpy.ones((5, 6, 5, 2))
FLAGS = numpy.zeros((5, 6, 5, 2))


# Dish coordinates for beam_fitting- the x parameter to be used in the fitting
DISH_COORD_AZ = numpy.array(
    [
        [
            -1.67656219e-05,
            -3.86416795e-05,
            2.54736615e-05,
        ],
        [
            1.07554380e-04,
            1.27813267e-04,
            -2.93635031e-05,
        ],
        [
            -4.95111837e-04,
            1.35920940e-04,
            -3.10228964e-04,
        ],
        [
            4.41771802e-04,
            -2.76304939e-04,
            -7.46971279e-05,
        ],
        [
            1.19623691e-04,
            -2.71621773e-05,
            -3.05732096e-04,
        ],
    ]
)

DISH_COORD_EL = numpy.array(
    [
        [
            -1.00010232,
            -1.00007682,
            -0.99994851,
        ],
        [
            -1.00002945,
            -1.00019367,
            -1.00028369,
        ],
        [
            -0.33340324,
            -0.33369256,
            -0.33330966,
        ],
        [
            -0.33344541,
            -0.33336226,
            -0.33341997,
        ],
        [0.33325741, 0.33344652, 0.33292203],
    ]
)


ACTUAL_POINTING_AZ = numpy.array(
    [
        [148.94151627, 148.94209042, 148.94269345],
        [148.9416127, 148.94223792, 148.9435879],
        [148.94151282, 148.94186983, 148.94285118],
        [148.94127324, 148.94149587, 148.94311848],
        [148.94128754, 148.94246971, 148.94286926],
    ]
)


ACTUAL_POINTING_EL = numpy.array(
    [
        [34.39740428, 34.41229524, 35.12337574],
        [34.39719755, 34.4118988, 35.12285761],
        [34.39757858, 34.41206149, 35.12348981],
        [34.39708119, 34.41189889, 35.12313388],
        [34.39734882, 34.41193127, 35.12321936],
    ]
)


class MockBaseTable:
    """
    Mock Base Table Class
    """

    def getcol(self, columnname=None):
        """
        Get column name
        """
        if columnname == "TIME":
            return VIS_TIMESTAMPS

        if columnname == "INTERVAL":
            return numpy.array([10.0])

        if columnname == "CPARAM":
            return numpy.ones((NTIMES, NANTS, NCHAN, 1))

        if columnname == "ANTENNA1":
            return numpy.array([0, 1, 2])

        if columnname == "SPECTRAL_WINDOW_ID":
            return numpy.array([0, 1])

        if columnname == "DATA":
            vis_3d = VIS[:, numpy.newaxis, :].repeat(NCHAN, axis=1)
            return numpy.array(vis_3d.reshape((NCORR, NCHAN, NPOL)))

        if columnname == "WEIGHT":
            return numpy.array(VIS_WEIGHTS.reshape((NCORR, NPOL)))


class MockSpectralWindowTable:
    """
    Mock Spectral Window Table Class
    """

    def getcol(self, columnname=None):
        """
        Get column name
        """
        if columnname == "CHAN_FREQ":
            return FREQS

        if columnname == "NUM_CHAN":
            return numpy.array([NCHAN])


class MockAntennaTable:
    """
    Mock Antenna Table Class
    """

    def getcol(self, columnname=None):
        """
        Get column name from MS File
        """
        if columnname == "NAME":
            return ["ANT1", "ANT2", "ANT3"]

        if columnname == "MOUNT":
            return MOUNT

        if columnname == "DISH_DIAMETER":
            return DIAMETER

        if columnname == "POSITION":
            return numpy.array(
                [
                    [-1601162.0, -5042003.0, 3554915.0],
                    [-1601192.0190292, -5042007.78341262, 3554960.73493029],
                    [-1601147.19047704, -5042040.12425644, 3554894.80919799],
                ]
            )

        if columnname == "OFFSET":
            return OFFSET

        if columnname == "STATION":
            return STATION


class MockPolarisationTable:
    """
    Mock Polarisation Table Class
    """

    def getcol(self, columnname=None):
        """
        Get column name
        """
        if columnname == "CORR_TYPE":
            return numpy.array([9, 12])


class MockPointingTable:
    """
    Mock Pointing Table Class
    """

    def getcol(self, columnname=None):
        """
        Get column name
        """
        if columnname == "SOURCE_OFFSET":
            return numpy.dstack((DISH_COORD_AZ, DISH_COORD_EL))

        if columnname == "DIRECTION":
            return numpy.dstack((ACTUAL_POINTING_AZ, ACTUAL_POINTING_EL))

        if columnname == "TIME":
            return POINTING_TIMESTAMPS
